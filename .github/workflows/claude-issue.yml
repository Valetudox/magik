name: Claude Issue Workflows

on:
  issues:
    types: [labeled]

jobs:
  planning:
    if: contains(github.event.issue.labels.*.name, 'planning')
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: read
      issues: write
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Run Claude Code Issue Planning
        id: claude-planning
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          prompt: |
            IMPORTANT: You are in PLAN MODE ONLY. Do NOT implement any code changes. 

            Please review this issue and follow the instructions.

            **Issue Details:**
            - Title: ${{ github.event.issue.title }}
            - Description: ${{ github.event.issue.body }}
            - Issue #${{ github.event.issue.number }}

            **Instructions:**
            - Use `gh issue comment` to post your plan as a comment on this issue. Try to create just one comment.
            - If you need to ask clarifying questions, include them in your response

          claude_args: '--allowed-tools "Bash(gh issue view:*),Bash(gh issue comment:*),Bash(gh issue list:*),Bash(gh search:*)"'
