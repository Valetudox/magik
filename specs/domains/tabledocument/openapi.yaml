openapi: 3.0.3
info:
  title: Backend Table Document API
  version: 1.0.0
  description: API for managing table documents with use cases and Confluence integration
  contact:
    name: API Support
    email: support@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:4004

tags:
  - name: health
    description: Health check operations
  - name: table-documents
    description: Table document operations
  - name: use-cases
    description: Use case operations
  - name: agent
    description: AI agent operations
  - name: confluence
    description: Confluence integration operations

paths:
  /health:
    get:
      summary: Health check endpoint
      description: Check if the service is running and healthy
      operationId: healthCheck
      tags:
        - health
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                required:
                  - status

  /api/table-documents:
    get:
      summary: List all table documents
      description: Retrieve a list of all table documents stored in the system
      operationId: listTableDocuments
      tags:
        - table-documents
      responses:
        '200':
          description: List of table documents
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TableDocument'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      summary: Create a new table document
      description: Create a new table document with the provided title and description
      operationId: createTableDocument
      tags:
        - table-documents
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTableDocumentRequest'
      responses:
        '201':
          description: Table document created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TableDocument'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/table-documents/{id}:
    get:
      summary: Get a specific table document
      description: Retrieve details of a specific table document by its ID
      operationId: getTableDocument
      tags:
        - table-documents
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Table document details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TableDocument'
        '404':
          description: Table document not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    patch:
      summary: Update a table document
      description: Update the title or description of a table document
      operationId: updateTableDocument
      tags:
        - table-documents
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTableDocumentRequest'
      responses:
        '200':
          description: Table document updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TableDocument'
        '404':
          description: Table document not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      summary: Delete a table document
      description: Delete a table document and all its associated use cases
      operationId: deleteTableDocument
      tags:
        - table-documents
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Table document deleted
        '404':
          description: Table document not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/table-documents/{id}/use-cases:
    post:
      summary: Create a new use case for a table document
      description: Add a new use case to an existing table document
      operationId: createUseCase
      tags:
        - use-cases
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUseCaseRequest'
      responses:
        '201':
          description: Use case created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UseCase'
        '404':
          description: Table document not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/table-documents/{id}/use-cases/{useCaseId}:
    patch:
      summary: Update a use case
      description: Update the details of an existing use case
      operationId: updateUseCase
      tags:
        - use-cases
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: useCaseId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUseCaseRequest'
      responses:
        '200':
          description: Use case updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UseCase'
        '404':
          description: Use case not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      summary: Delete a use case
      description: Remove a use case from a table document
      operationId: deleteUseCase
      tags:
        - use-cases
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: useCaseId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Use case deleted
        '404':
          description: Use case not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/table-documents/{id}/agent:
    post:
      summary: Run agent on a table document
      description: Execute an AI agent with a custom prompt on the table document
      operationId: runAgent
      tags:
        - agent
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                prompt:
                  type: string
              required:
                - prompt
      responses:
        '200':
          description: Agent executed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  result:
                    type: string
        '404':
          description: Table document not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/table-documents/{id}/push-to-confluence:
    post:
      summary: Push table document to Confluence
      description: Export and publish the table document to a Confluence page
      operationId: pushToConfluence
      tags:
        - confluence
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                pageUrl:
                  type: string
              required:
                - pageUrl
      responses:
        '200':
          description: Successfully pushed to Confluence
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  url:
                    type: string
        '404':
          description: Table document not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    TableDocument:
      type: object
      additionalProperties: false
      properties:
        success:
          type: boolean
        id:
          type: string
        title:
          type: string
        description:
          type: string
        useCases:
          type: array
          items:
            $ref: '#/components/schemas/UseCase'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - title
        - useCases
        - createdAt
        - updatedAt

    UseCase:
      type: object
      additionalProperties: false
      properties:
        success:
          type: boolean
        id:
          type: string
        title:
          type: string
        description:
          type: string
        actors:
          type: array
          items:
            type: string
        preconditions:
          type: array
          items:
            type: string
        steps:
          type: array
          items:
            type: string
        postconditions:
          type: array
          items:
            type: string
      required:
        - id
        - title

    CreateTableDocumentRequest:
      type: object
      additionalProperties: false
      properties:
        title:
          type: string
        description:
          type: string
      required:
        - title

    UpdateTableDocumentRequest:
      type: object
      additionalProperties: false
      properties:
        title:
          type: string
        description:
          type: string

    CreateUseCaseRequest:
      type: object
      additionalProperties: false
      properties:
        title:
          type: string
        description:
          type: string
        actors:
          type: array
          items:
            type: string
        preconditions:
          type: array
          items:
            type: string
        steps:
          type: array
          items:
            type: string
        postconditions:
          type: array
          items:
            type: string
      required:
        - title

    UpdateUseCaseRequest:
      type: object
      additionalProperties: false
      properties:
        title:
          type: string
        description:
          type: string
        actors:
          type: array
          items:
            type: string
        preconditions:
          type: array
          items:
            type: string
        steps:
          type: array
          items:
            type: string
        postconditions:
          type: array
          items:
            type: string

    Error:
      type: object
      additionalProperties: false
      properties:
        error:
          type: string
      required:
        - error
