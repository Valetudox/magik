openapi: 3.0.3
info:
  title: Specification API
  description: API for managing and viewing specification documents with EARS-formatted requirements
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
servers:
  - url: http://localhost:4002
    description: Local development server
  - url: http://localhost:3003
    description: Production server
tags:
  - name: health
    description: Health check operations
  - name: specifications
    description: Specification document operations
paths:
  /health:
    get:
      summary: Health check
      description: Returns the health status of the API
      operationId: healthCheck
      tags:
        - health
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
  /api/specifications:
    get:
      tags:
        - specifications
      summary: List all specifications
      description: Returns a list of all specification documents with metadata
      operationId: listSpecifications
      responses:
        '200':
          description: Successful response with list of specifications
          content:
            application/json:
              schema:
                type: object
                properties:
                  specifications:
                    type: array
                    items:
                      $ref: '#/components/schemas/SpecificationSummary'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/specifications/{id}:
    get:
      tags:
        - specifications
      summary: Get specification by ID
      description: Returns the complete specification document with all requirements
      operationId: getSpecificationById
      parameters:
        - name: id
          in: path
          required: true
          description: Specification ID (filename without .json extension)
          schema:
            type: string
            example: specification-viewer
      responses:
        '200':
          description: Successful response with specification details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SpecificationDetail'
        '404':
          description: Specification not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error (e.g., invalid JSON)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
components:
  schemas:
    SpecificationSummary:
      type: object
      required:
        - id
        - title
        - description
        - filepath
      properties:
        id:
          type: string
          description: Unique identifier (filename without .json extension)
          example: specification-viewer
        title:
          type: string
          description: Title of the specification
          example: Specification Viewer System
        description:
          type: string
          description: Brief description of the specification
          example: A read-only system for viewing and displaying specifications stored in the specs folder
        filepath:
          type: string
          description: Full filesystem path to the specification file
          example: /home/magic/repositories/magik/specs/projects/magik/specification-viewer.json
    SpecificationDetail:
      type: object
      required:
        - id
        - title
        - description
        - requirements
      properties:
        id:
          type: string
          description: Unique identifier (filename without .json extension)
          example: specification-viewer
        title:
          type: string
          description: Title of the specification
          example: Specification Viewer System
        description:
          type: string
          description: Detailed description of the specification
          example: A read-only system for viewing and displaying specifications stored in the specs folder
        requirements:
          type: array
          description: Array of requirement sections
          items:
            $ref: '#/components/schemas/SpecificationSection'
    SpecificationSection:
      type: object
      required:
        - sectionName
        - items
      properties:
        sectionName:
          type: string
          description: Name of the requirement section
          example: Backend API - Specification Listing
        items:
          type: array
          description: Array of requirements in this section
          items:
            $ref: '#/components/schemas/SpecificationRequirementItem'
    SpecificationRequirementItem:
      type: object
      required:
        - type
        - systemName
        - systemResponse
      properties:
        type:
          type: string
          description: EARS requirement type
          enum:
            - ubiquitous
            - event-driven
            - state-driven
            - optional-feature
            - unwanted-behaviour
            - complex
          example: event-driven
        systemName:
          type: string
          description: Name of the system being specified
          example: the system
        systemResponse:
          type: string
          description: What the system shall do
          example: scan the specs folder and return metadata for all specification files
        triggers:
          type: array
          description: Event triggers (for event-driven and complex types)
          items:
            type: string
          example:
            - a request is made to the specification listing endpoint
        preConditions:
          type: array
          description: State preconditions (for state-driven and complex types)
          items:
            type: string
          example:
            - specifications are being loaded from the API
        features:
          type: array
          description: Optional features (for optional-feature and complex types)
          items:
            type: string
          example:
            - the system includes export functionality
        unwantedConditions:
          type: array
          description: Unwanted conditions (for unwanted-behaviour types)
          items:
            type: string
          example:
            - a specification file cannot be parsed or is invalid JSON
    Error:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: Error message
          example: Specification not found
